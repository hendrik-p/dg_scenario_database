{% extends 'base.html' %}

{% block content %}

<div class="container">
    <form method="POST" action="{{ url_for('edit_scenarios') }}">
      {{ form.hidden_tag() }}
      <div class="form-group">
        {{ form.scenario_id.label(class="form-label") }}
        {{ form.scenario_id(class="form-control") }}
        {% for error in form.title.errors %}
          <span class="text-danger">{{ error }}</span>
        {% endfor %}
      </div>
      <div class="form-group">
        {{ form.title.label(class="form-label") }}
        {{ form.title(class="form-control") }}
        {% for error in form.title.errors %}
          <span class="text-danger">{{ error }}</span>
        {% endfor %}
      </div>
      <div class="form-group">
        {{ form.teaser.label(class="form-label") }}
        {{ form.teaser(class="form-control") }}
        {% for error in form.teaser.errors %}
          <span class="text-danger">{{ error }}</span>
        {% endfor %}
      </div>
      <div class="form-group">
        {{ form.author.label(class="form-label") }}
        {{ form.author(class="form-control") }}
        {% for error in form.author.errors %}
          <span class="text-danger">{{ error }}</span>
        {% endfor %}
      </div>
      <div class="form-group">
        {{ form.year.label(class="form-label") }}
        {{ form.year(class="form-control") }}
        {% for error in form.year.errors %}
          <span class="text-danger">{{ error }}</span>
        {% endfor %}
      </div>
      <div class="form-group">
        {{ form.category.label(class="form-label") }}
        {{ form.category(class="form-select") }}
        {% for error in form.category.errors %}
          <span class="text-danger">{{ error }}</span>
        {% endfor %}
      </div>
      <div class="form-group">
        {{ form.url.label(class="form-label") }}
        {{ form.url(class="form-control") }}
        {% for error in form.url.errors %}
          <span class="text-danger">{{ error }}</span>
        {% endfor %}
      </div>
      <div class="form-group">
        {{ form.submit(class="btn btn-secondary") }}
      </div>
    </form>

  <table class="table table-bordered table-striped table-hover" style="width:100%">
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Teaser</th>
        <th>Author</th>
        <th>Year</th>
        <th>Category</th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for scenario in scenarios %}
      <tr>
        <td>{{ scenario.id }}</td>
        <td>{{ scenario.title }}</td>
        <td>{{ scenario.teaser }}</td>
        <td>{{ scenario.author }}</td>
        <td>{{ scenario.year }}</td>
        <td>{{ scenario.category }}</td>
        <td>
          <button id="{{scenario.id }}" type="button" class="btn btn-secondary btn-sm" onclick="fillEditForm(this.id)">Edit</button>
        </td>
        <td>
          <button id="{{ scenario.id }}"type="button" class="btn btn-secondary btn-sm" onclick="deleteScenario(this)">Delete</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  function fillEditForm (id) {
      $.ajax({
          url: '/get_scenario',
          method: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({scenario_id: id}),
          success: function (response) {
              $('#scenario_id').val(response.scenario_id);
              $('#title').val(response.title);
              $('#teaser').val(response.teaser);
              $('#author').val(response.author);
              $('#year').val(response.year);
              $('#category').val(response.category);
              $('#url').val(response.url);
          }
      });
  }
  function deleteScenario (button) {
      id = $(button).attr("id")
      $.ajax({
          url: '/delete_scenario',
          method: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({scenario_id: id}),
          success: function (response) {
              row = $(button).closest("tr");
              row.remove();
          }
      });

  }
</script>

{% endblock %}

